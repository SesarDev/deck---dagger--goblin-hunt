[gd_scene load_steps=2 format=3 uid="uid://bkcrmtwatp1qd"]

[sub_resource type="GDScript" id="GDScript_e5i6c"]
script/source = "extends Control

@onready var title_label: Label = $TitleLabel
@onready var username_input: LineEdit = $UsernameInput
@onready var login_button: Button = $LoginButton
@onready var message_label: Label = $MessageLabel

const ADMIN_PANEL_SCENE := \"res://src/scenes/admin/AdminPanel.tscn\"

func _ready() -> void:
	title_label.text = \"Deck & Dagger - Login\"
	message_label.text = \"\"
	login_button.pressed.connect(_on_login_button_pressed)

func _on_login_button_pressed() -> void:
	var username := username_input.text.strip_edges()

	if username.is_empty():
		_set_message(\"Please enter a username.\", Color.ORANGE_RED)
		return

	# Iniciamos sesiÃ³n o registramos si no existe
	Game.login_or_register(username, false)

	if not Game.is_logged_in():
		_set_message(\"Login failed. Check database.\", Color.RED)
		return

	if Game.is_admin():
		_set_message(\"Welcome, admin: %s\" % username, Color.LAWN_GREEN)
		_go_to_admin_panel()
	else:
		_set_message(\"User '%s' is not ADMIN. Access denied.\" % username, Color.ORANGE_RED)

func _go_to_admin_panel() -> void:
	var scene_res := load(ADMIN_PANEL_SCENE)
	if scene_res == null:		push_error(\"[AdminLogin] Cannot load AdminPanel scene.\")
		return

	get_tree().change_scene_to_packed(scene_res)

func _set_message(text: String, color: Color) -> void:
	message_label.text = text
	message_label.modulate = color
"

[node name="AdminLogin" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
script = SubResource("GDScript_e5i6c")

[node name="TitleLabel" type="Label" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.4
anchor_top = 0.1
anchor_right = 0.6
anchor_bottom = 0.1
text = "Admin / User Login"
horizontal_alignment = 1

[node name="UsernameInput" type="LineEdit" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.4
anchor_top = 0.2
anchor_right = 0.6
anchor_bottom = 0.2

[node name="LoginButton" type="Button" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.4
anchor_top = 0.3
anchor_right = 0.6
anchor_bottom = 0.3
text = "Login"

[node name="MessageLabel" type="Label" parent="."]
layout_mode = 1
anchors_preset = -1
anchor_left = 0.3
anchor_top = 0.5
anchor_right = 0.7
anchor_bottom = 0.8
